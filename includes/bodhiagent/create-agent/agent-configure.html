<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link href="../../../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../../../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../../../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_bodhiagent includes_bodhiagent_create-agent includes_bodhiagent_create-agent_agent-configure">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../../../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a class="bodhi-logo" href="http://docs.bodhi.space"> <img src="../../../images/logo.png" /> </a>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h4 id="configuring-agent-application">Configuring Agent Application</h4>

<h3 id="parameters">Parameters</h3>

<p>Mutable environmental variables that can be modified in Agent Manager. Values can overwrite default settings.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>description</td>
<td>String</td>
<td>Description in Agent manager application</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Expected data type of parameter value</td>
</tr>
<tr>
<td>setting</td>
<td>String</td>
<td>Assigned variable name to this parameter</td>
</tr>
<tr>
<td>required</td>
<td>Boolean</td>
<td>True or False</td>
</tr>
<tr>
<td>default</td>
<td>String</td>
<td>The default value of the parameter if not set</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Parameters example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>parameters : {
        master_id: {
            description : 'System ID of Master Agent',
            setting     : 'master_id',
            type        : 'string',
            required    : true
        },
        role: {
            description : 'Role of Master Agent for Slave to assume',
            type        : 'string',
            setting     : 'role',
            required    : true
        }
}
</code></pre>

<h3 id="extensions">Extensions</h3>

<p>Extensions are injected dependencies that your application can refer to. Your application may use one or more extensions. Extensions can provide potential configuration components or actual runtime components. Extensions are a good way to design resuable components that can be shared and reused across projects. Extensions are loaded in the order in which they are specified.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>module</td>
<td>String</td>
<td>Yes</td>
<td>By default searches node_modules folder. Relative path also accepted.</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Extensions example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>extensions  : [
        { module: './lib/plugin.js' },
        { module: 'agent-ext-timers' }
]
</code></pre>

<h3 id="settings">Settings</h3>

<p>A Setting is an Object that represents static configuration data. Parameters can overwrite a setting if the property matches a parameter key.
These values will take the highest precedence in the processing of settings. The precedence rules are:</p>

<ol>
<li>Agent.json settings object (highest precedence)</li>
<li>Any settings within the js/json files in the settings folder</li>
<li>Any settings added by an extension (lowest precedence)</li>
</ol>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>property</td>
<td>String</td>
<td>Yes</td>
<td>Name of your property</td>
</tr>
<tr>
<td>value</td>
<td>String, Function, Boolean, Number, Object</td>
<td>Yes</td>
<td>The value of your setting</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Settings example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>settings: [
        {
            property: 'master_id',
            value: '588f9fc508a94349cc1ad3b8'
        },
        {
            property: 'role',
            value   : 'pos-monitor'
        }
]
</code></pre>

<h3 id="counters">Counters</h3>

<p>Tracks the number of times specific application events occur and are logged found in the Agent heartbeat. Each counter can subscribe to an array of application events.</p>

<blockquote>
<p><strong>Counters example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code> counters: {
        activations : ['app:monitor'],
        success     : ['app:success'],
        stopped     : ['app:stopped'],
        failed      : ['app:failed' ]
}
</code></pre>

<h3 id="sources">Sources</h3>

<p>An object that sources external events. Sources bind events to listeners and emits application level events. Any counters, handlers and pipelines subscribed to source events are initiated.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>Unique identifier (within the context&rsquo;s handler)</td>
</tr>
<tr>
<td>provider</td>
<td>String or Function</td>
<td>Yes</td>
<td>A function or reference to a plugin that creates an object</td>
</tr>
<tr>
<td>args</td>
<td>Array of Strings, Functions, Objects, Booleans</td>
<td>Optional</td>
<td>A list of dependencies used by the source</td>
</tr>
<tr>
<td>bindings</td>
<td>Object</td>
<td>Optional</td>
<td>A Map that routes external events to internal topics</td>
</tr>
<tr>
<td>factory</td>
<td>String</td>
<td>Optional</td>
<td>An enumeration that describes alternate instantiation behavior for the service constructor, function, literal</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Sources example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>sources: [ 
        {
           name: 'sampleSource',
           provider: 'compris:dir',
           args: ['$settings:rootPath'],
           bindings: { 'created' : 'read' }
        } 
]
</code></pre>

<h3 id="services">Services</h3>

<p>A Service is an Object that represents a concrete extension of the API. Services are singletons.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>Unique identifier (within the context&rsquo;s handler)</td>
</tr>
<tr>
<td>provider</td>
<td>String or Function</td>
<td>Yes</td>
<td>A function or reference to a plugin that creates an object</td>
</tr>
<tr>
<td>args</td>
<td>Array of Strings, Functions, Objects, Booleans</td>
<td>Optional</td>
<td>A list of the dependencies used by the service</td>
</tr>
<tr>
<td>factory</td>
<td>String (Constructor, Function, Literal)</td>
<td>Optional</td>
<td>An enumeration that describes alternate instantiation behavior for the service</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Services example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>services: [
        {
            name: 'cloud',
            provider: 'connection:resources'
        }
]
</code></pre>

<h3 id="handlers">Handlers</h3>

<p>A Handler is a Function that responds to events within an application. </p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>Unique identifier (within the context&rsquo;s handler)</td>
</tr>
<tr>
<td>subscriptions</td>
<td>Array <String></td>
<td>Yes</td>
<td>String of application level events that will initiate this handler</td>
</tr>
<tr>
<td>fn</td>
<td>String or Function</td>
<td>Yes</td>
<td>A function or reference to a plugin will handle the events</td>
</tr>
<tr>
<td>props</td>
<td>Object</td>
<td>Optional</td>
<td>A list of properties available to the instance</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Handlers example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>handlers: [
        {
            name            : 'Monitor Master Agent',
            subscriptions   : ['app:monitor'],
            fn              : '$plugins:handler:monitor',
            props           : {
                master_role : '$setting:role',
                conn        : '$service:cloud',
                master_id   : '$setting:master_id',
                getInfo     : '$plugins:core:info',
                identity    : '$plugins:core:identity',
            }
        },
        {
            name            : 'Update Agent Role',
            subscriptions   : ['app:update'],
            fn              : '$plugins:handler:update',
            props           : {
                conn        : '$service:cloud',
            }
        }
]
</code></pre>

<h3 id="pipelines">Pipelines</h3>

<p>Similar to handlers, pipeline(s) are subscribed to event(s). The difference being that pipelines execute a series of steps rather than just one function. 
Each pipeline step should follow the single responsiblity principle. Each step is given two arguments - input and a callback.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>Name of your pipeline</td>
</tr>
<tr>
<td>subscriptions</td>
<td>Array</td>
<td>Yes</td>
<td>String of application level events that will initiate this pipeline</td>
</tr>
<tr>
<td>steps</td>
<td>Array</td>
<td>Yes</td>
<td>Takes an array of objects that refer to function plugin references as well as an optional injected props referenced by the keyword &ldquo;this&rdquo;</td>
</tr>
<tr>
<td>stopped</td>
<td>String</td>
<td>Optional</td>
<td>Emits mapped event based on the state of the pipeline</td>
</tr>
<tr>
<td>failed</td>
<td>String</td>
<td>Optional</td>
<td>Emits mapped event based on the state of the pipeline</td>
</tr>
<tr>
<td>success</td>
<td>String</td>
<td>Optional</td>
<td>Emits mapped event based on the state of the pipeline</td>
</tr>
<tr>
<td>done</td>
<td>String</td>
<td>Optional</td>
<td>Emits mapped event based on the state of the pipeline</td>
</tr>
</tbody></table>

<blockquote>
<p><strong>Pipelines example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>// pipeline breakdown of handlers

    pipelines: [
        {
            name: 'Monitor Master Agent',
            subscriptions: ['app:monitor'],
            steps: [
                { fn: '$plugins:core:identity:addAgentInfo'     },
                { fn: '$plugins:main:checkMasterAgentStatus'    },
                { fn: '$plugins:main:processAgentStatus'        }
            ],
            stopped : 'app:stopped',
            failed  : 'app:failed'
        },
        {
            name: 'Update Status',
            subscriptions: ['app:update'],
            steps: [
                { fn: '$plugins:main:patchAgentRole'    },
                { fn: '$plugins:main:syncAgent'         }
            ],
            stopped : 'app:stopped',
            failed  : 'app:failed'
        }
]
</code></pre>

<h3 id="init">Init</h3>

<p>Init is a function that is given a callback as its only argument.
This callback must be invoked in order to intialize the application. 
The keyword &ldquo;this&rdquo; refers to the application&rsquo;s reactive context</p>

<blockquote>
<p><strong>Init example</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>init: function(done){

        this.publish('app:initialized');

        console.log('###################################');
        console.log('## ' + pkg.name.toUpperCase());
        console.log('## v' + pkg.version);
        console.log('###################################');

        done();
}
</code></pre>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>

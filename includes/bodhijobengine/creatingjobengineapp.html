<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link href="../../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_bodhijobengine includes_bodhijobengine_creatingjobengineapp">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <a class="bodhi-logo" href="http://docs.bodhi.space"> <img src="../../images/logo.png" /> </a>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <p><strong>Work Functions</strong> <br>
Jobs must be built in a specific format in order for Bodhi Job Engine to recognize and run them properly. The job should contain an <strong>index.js</strong> file that follows this structure:</p>

<blockquote>
<p><strong>index.js</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>module.exports = function work(context, done){
    //the work of your job
    done(errThatOccurred, messageToReport, stateToSave);
};

</code></pre>

<p><strong>Context Object</strong> <br>
{ <br>
 connection: bodhi-js-client <br>
 settings  : Object - immutable configuration options associated with this job <br>
 state     : Object - mutable persistent state from previous runs <br>
 meta      : Object - immutable metadata about the job <br>
}</p>

<p><strong>Job Metadata</strong> <br>
{ <br>
    name      : String - name of the job <br>
    package   : String - package name <br>
    version   : String - semantic package version <br>
    namespace : String - namespace of the job <br>
    lastRun   : Data   - last time the job ran <br>
} <br></p>

<p><strong>Callback</strong> <br>
A job must be completed by calling the callback</p>

<table><thead>
<tr>
<th>arg</th>
<th>type</th>
<th>required</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>err</td>
<td>Error</td>
<td>optional</td>
<td>if err != null then the job did not process properly</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>optional</td>
<td>a string to be recorded in the message</td>
</tr>
<tr>
<td>state</td>
<td>Object</td>
<td>optional</td>
<td>the state to persist for the next run</td>
</tr>
</tbody></table>

<p><strong>Example Job: Hello World</strong></p>

<blockquote>
<p><strong>This is a very basic Hello World job.</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>module.exports = function(options, done){
  console.log('HELLO WORLD!');

  if(err){
    done(err);
  }
  else{
    done();
  }
};
</code></pre>

<p><strong>Example Job: Get and Use Some Data</strong></p>

<blockquote>
<p><strong>Get and use data</strong></p>
</blockquote>
<pre class="highlight plaintext"><code>module.exports = function(options, done){

  var client = options.connection;
  var data   = options.state;
  data.storestuff = [];

  client.get(['resources', 'Store'].join('/'), function(err, data, ctx){
    if(err){
      done(err);
    }
    else{
      data.forEach(function(store){
        data.storestuff.push(store.store_name + ' is an awesome store!');
      });
    }
  });

  var json = {

    "data1": "some data you need to post",
    "data2": "also data you need to post"
  };

  client.post(['resources', 'aCustomType'].join('/'), json, function(err, data, ctx){

    if(err){
      done(err);
    }
    else{
      console.log('Server says: ', ctx);
      done();
    }
  });
};

</code></pre>

<p>This is a less basic example job that uses HTTP requests and stores data in the &ldquo;state&rdquo; property of the options object. Data stored in the state property persists between jobs and is available in the next execution of the job.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
